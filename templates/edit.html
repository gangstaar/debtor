{% extends 'base.html' %}

{% block header %}
<h1>
{% block title %}
Редактирование -
{% if budget_file %}
    {{budget_file[:-4]}}
{% else %}
    не выбран
{% endif %}
{% endblock %}
</h1>
{% endblock %}

{% block content %}
<hr>
<table>
    <tr>
        <td>Имя файла: </td>
        <form method="post" name="editbudgetfilename"
              action="{{url_for('budget.edit_budget_file_name', budget_file=budget_file)}}">
            <td><input name="filename" value="{{budget_file[:-4]}}" size="20"></td>
            </td>
            <td><input type="image" src="{{url_for('static', filename='ok.png')}}" alt="Ок"></td>
        </form>
    </tr>
</table>
<hr>
<h3></h3>
<table>
    <tr>
        <td>
          Описание:
        </td>
        <form method="post" name="editbudgetmemo"
              action="{{url_for('budget.edit_budget_edit_memo', budget_file=budget_file)}}">
            <td><input name="memo" value="{{budget.memo}}" size="30"></td>
            </td>
            <td><input type="image" src="{{url_for('static', filename='ok.png')}}" alt="Ок"></td>
        </form>
    </tr>
</table>

{% if budget.debt_operations_list.__len__() > 0 %}
<hr>

<h3>Транзакции</h3>

<form method="post" name="calculatebuttons"
      action="{{url_for('budget.edit_budget_calculate', budget_file=budget_file)}}">

    <table cellpadding="2">
        <tr align="center">
            <td><b>Алгоритм расчёта:</b></td>
            <td><input name="simple" type="submit" value="Простой"></td>
            <td><input name="monte-carlo" type="submit" value="Монте-Карло"></td>
        </tr>
        <tr>
            <td colspan="3"> </td>
        </tr>
    </table>
</form>


<table cellpadding="5">
    {% for op in budget.debt_operations_list %}
    <tr>
        <td>{{op.debtor.name}}</td><td> ----> </td><td>{{op.creditor.name}}</td><td>{{"{0:8.2f}".format(op.amount)}} Р</td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<hr>

<h3>Участники</h3>

<table border="0" cellpadding="3" rules="rows">
    <tr>
        <td><b>Имя</b></td>
        <td><b>Вес</b></td>
        <td><b>Платит за</b></td>
        <td></td>
    </tr>
    {% for person in budget.persons_list %}
    <tr>
        <td>{{person.name}}</td>
        <td>{{person.weight}}</td>
        <td>{{person.pays_for}}</td>
        <td>
            <form method="post" name="deleteperson"
                  action="{{url_for('budget.edit_budget_remove_person', budget_file=budget_file, person_name=person.name)}}">
            <input name="deleteperson{{budget.persons_list.index(person)}}"
                   type="image" alt="Удалить"
                   src="{{url_for('static', filename='cross.png')}}">
            </form>
        </td>
    </tr>
    {% endfor %}
    <form method="post" name="addperson"
          action="{{url_for('budget.edit_budget_add_person', budget_file=budget_file)}}">
        <td>
            <input name="name" type="text" size="10">
        </td>
        <td>
            <input name="weight" type="text" size="5" value="1.0">
        </td>
        <td>
            <datalist id="personslist">
                {% for person in budget.persons_list %}<option>{{person.name}}</option>{% endfor %}
            </datalist>
            <input name="paysfor" type="text" list="personslist" size="10">
        </td>
        <td>
            <input name="addperson" type="image" src="{{url_for('static', filename='plus.png')}}"  alt="Добавить">
        </td>

    </form>
</table>

<hr>

<h3>Операции</h3>

<table border="0" cellpadding="3" rules="rows">
    <tr>
        <td><b>Сумма</b></td>
        <td><b>Описание</b></td>
        <td><b>Оплатил</b></td>
        <td></td>
    </tr>
    {% for s in budget.spending_list %}
    <tr>
        <td width="80">{{s.amount}}</td>
        <td width="200">{{s.memo}}</td>
        <td width="100">{{s.payer.name}}</td>
        <form method="post" name="spendingoperation"
              action="{{url_for('edit_budget_edit_spending', budget_file=budget_file, spending_number=budget.spending_list.index(s))}}">
            <td>
                <input name="editspending" type="image" alt="Редактировать"
                       src="{{url_for('static', filename='edit.png')}}">
            </td>
            <td>
                <input name="deletespending" type="image" alt="Удалить"
                       src="{{url_for('static', filename='cross.png')}}">
            </td>
        </form>
    </tr>
    {% endfor %}
    <form method="post" name="addspending"
          action="{{url_for('edit_budget_add_spending', budget_file=budget_file)}}">
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>
            <input name="addspending" type="image"  alt="Добавить" src="{{url_for('static', filename='plus.png')}}">
        </td>

    </form>
</table>

<hr>

{% endblock %}